redis服务器是典型的一对多服务器程序，一个服务器可以和多个客户端建立网络请求，而服务器则接受并处理客户端发来的请求。

通过使用IO多路复用技术实现的文件事件监听器，redis服务器使用单线程单进程的方式来处理命令请求。

对于每个和服务器进行连接的客户端，服务器都为这些客户端建立了相应的redisClient结构，这个结构保存了客户端的当前状态信息，以及执行相应功能需要用到的数据结构。

redis服务器状态的clients属性是一个链表，这个链表保存了所有和redis服务器相连的redis客户端的状态结构，对某个客户端的操作，都可以通过遍历链表来实现。

## 客户端属性

包括两类：

* 通用的属性
* 和特定功能相关的属性

### 套接字描述符

客户端状态的fd属性记录了客户端正在使用的套接字描述符：

	typedef struct redisClient {
		// ...
		int fd;
		// ...
	}

根据客户端属性的不同，fd的值可以是-1或者>-1的整数

* 伪客户端的fd值为-1
* 普通客户端的fd属性>-1

### 名字

默认情况下，一个连接到服务器的客户端是没有name属性的，但是可以通过CLIENT setname来指定，没有名字的话，客户端状态的name属性会指向一个NULL，否则的话会指向一个字符串

### 标志

客户端的标志属性flags记录了客户端的角色，以及客户端所处的状态。

### 输入缓冲区

客户端输入缓冲区用于保存客户端发送的命令请求。

输入缓冲区的大小会根据输入内容动态的缩小或者扩大，但是它的最大大小不能超过1GB，否则服务器将关闭这个客户端。

### 命令与命令参数

在服务器端将客户端发送的命令请求保存到客户端的querybuf属性之后，服务器将对命令请求的内容进行分析，并将得到的命令参数和命令参数的个数保存到客户端的argv属性和argc属性。

### 命令的实现函数

服务器会根据argv[0]的值，在命令表中查找命令所对应的实现函数。

客户端状态的cmd指针会指向命令实现的具体函数

### 输出缓冲区

执行命令所得的命令回复会被保存在客户端状态的输出缓冲区里面，每个客户端都有两个缓冲区可用，一个缓冲区的大小是固定的，一个缓冲区的大小是可变的。

* 固定大小的缓冲区用于保存比较小的回复
* 可变大小的缓冲区用于保存比较大回复

### 身份验证

客户端状态的authenticated属性用于记录客户端是否通过了验证：

为0表示未通过验证，为1表示通过了验证，如果服务器没启用验证功能，默认值就是0，此时服务器不会拒绝客户端发送的非 auth命令。

### 时间

客户端状态还保存了几个和时间有关的状态：

* ctime属性记录了创建客户端的时间。
* lastinteraction属性记录了客户端最后一次和服务器进行交互的时间
* obuf\_sort\_limit\_reached\_time 记录了缓冲区第一次到达软性限制的时间

